# ğŸš€ HaioCloud Kubernetes Platform

[![Kubernetes](https://img.shields.io/badge/Kubernetes-K3s%20v1.33-326CE5?logo=kubernetes&logoColor=white)](https://k3s.io/)
[![Alpine](https://img.shields.io/badge/Alpine-KDE-0D597F?logo=alpine-linux&logoColor=white)](https://alpinelinux.org/)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

Ù¾Ù„ØªÙØ±Ù… Kubernetes Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ø³Ú©ØªØ§Ù¾â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²ÛŒ Ø¨Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù…Ø±ÙˆØ±Ú¯Ø±

[English](#) | [ÙØ§Ø±Ø³ÛŒ](#)

---

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª

- [Ù…Ø¹Ø±ÙÛŒ](#-Ù…Ø¹Ø±ÙÛŒ)
- [Ù…Ø¹Ù…Ø§Ø±ÛŒ](#ï¸-Ù…Ø¹Ù…Ø§Ø±ÛŒ)
- [ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§](#-ÙˆÛŒÚ˜Ú¯ÛŒÙ‡Ø§)
- [Ù†ØµØ¨](#-Ù†ØµØ¨)
- [Ø§Ø³ØªÙØ§Ø¯Ù‡](#-Ø§Ø³ØªÙØ§Ø¯Ù‡)
- [Ù…Ø¯ÛŒØ±ÛŒØª](#-Ù…Ø¯ÛŒØ±ÛŒØª)
- [Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯](#-Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯)
- [Backup](#-backup)
- [Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ](#-Ø¹ÛŒØ¨ÛŒØ§Ø¨ÛŒ)

---

## ğŸ¯ Ù…Ø¹Ø±ÙÛŒ

**HaioCloud** ÛŒÚ© Ù¾Ù„ØªÙØ±Ù… Kubernetes Ø§Ø³Øª Ú©Ù‡ Ø¯Ø³Ú©ØªØ§Ù¾â€ŒÙ‡Ø§ÛŒ Ù…Ø¬Ø§Ø²ÛŒ Linux Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ù…Ø±ÙˆØ±Ú¯Ø± Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.

### Ú†Ø±Ø§ HaioCloudØŸ

âœ… **Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø¢Ø³Ø§Ù†** - Ù†ØµØ¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø¯Ù‡  
âœ… **Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±** - Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ØµØ¯Ù‡Ø§ Ú©Ø§Ø±Ø¨Ø±  
âœ… **Ø§ÛŒØ²ÙˆÙ„Ù‡** - Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± Ù…Ø­ÛŒØ· Ø§Ø®ØªØµØ§ØµÛŒ  
âœ… **Ø¯Ø³ØªØ±Ø³ÛŒ Ø¢Ø³Ø§Ù†** - ÙÙ‚Ø· Ù…Ø±ÙˆØ±Ú¯Ø±ØŒ Ø¨Ø¯ÙˆÙ† VPN  
âœ… **Ù…Ø¯ÛŒØ±ÛŒØª Ø³Ø§Ø¯Ù‡** - Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø±  

---

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ

### Ú©Ù„Ø§Ø³ØªØ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         HaioCloud K8s Cluster              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Master          Worker1        Worker2    â”‚
â”‚  .207            .203            .241       â”‚
â”‚  â€¢ K3s           â€¢ Pods          â€¢ Pods    â”‚
â”‚  â€¢ MetalLB       â€¢ Storage       â€¢ Storage â”‚
â”‚  â€¢ Traefik                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ø¬Ø±ÛŒØ§Ù† Ø¯Ø±Ø®ÙˆØ§Ø³Øª

```
Browser â†’ DNS â†’ MetalLB â†’ Traefik â†’ Service â†’ Pod â†’ Desktop
```

### Ø§Ø¬Ø²Ø§

| Component | Version | Purpose |
|-----------|---------|---------|
| K3s | v1.33.5 | Kubernetes |
| MetalLB | v0.14.8 | LoadBalancer |
| Traefik | v3.x | Ingress |
| local-path | Built-in | Storage |

---

## âœ¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§

- ğŸ–¥ï¸ **Desktop**: KDE Plasma on Alpine
- ğŸ’¾ **Storage**: 5GB per user (Ù‚Ø§Ø¨Ù„ Ø§ÙØ²Ø§ÛŒØ´)
- ğŸ” **Security**: Password ØªØµØ§Ø¯ÙÛŒØŒ Pod isolation
- ğŸ“Š **Resources**: 250m-1000m CPU, 512Mi-2Gi RAM

---

## ğŸš€ Ù†ØµØ¨

### Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

- 3 Ø³Ø±ÙˆØ± Ubuntu 20.04/22.04
- 4GB RAM per server
- Ø¯Ø§Ù…Ù†Ù‡ Ø¨Ø§ wildcard DNS

### Ù†ØµØ¨ Ø³Ø±ÛŒØ¹

```bash
git clone https://github.com/Mehrdad-Hooshmand/haiocloud-k8s.git
cd haiocloud-k8s
bash auto-install.sh
```

### Ù†ØµØ¨ Ø¯Ø³ØªÛŒ

```bash
# 1. K3s Master
ssh k8s-master < 01-install-k3s-master.sh

# 2. Get Token
K3S_TOKEN=$(ssh k8s-master "cat /var/lib/rancher/k3s/server/node-token")

# 3. Workers
ssh k8s-worker1 "K3S_TOKEN=$K3S_TOKEN K3S_URL=https://94.182.92.207:6443 bash" < 02-install-k3s-worker.sh
ssh k8s-worker2 "K3S_TOKEN=$K3S_TOKEN K3S_URL=https://94.182.92.207:6443 bash" < 02-install-k3s-worker.sh

# 4. MetalLB
ssh k8s-master < 03-install-metallb.sh

# 5. Traefik  
ssh k8s-master < 04-install-traefik.sh

# 6. DNS
# Cloudflare: A * â†’ 94.182.92.207
```

---

## ğŸ’» Ø§Ø³ØªÙØ§Ø¯Ù‡

### Ø³Ø§Ø®Øª Ú©Ø§Ø±Ø¨Ø±

```bash
ssh k8s-master "bash /root/create-webtop.sh USERNAME"
```

**Ø®Ø±ÙˆØ¬ÛŒ:**
```
URL: http://USERNAME.haiocloud.com
Username: admin
Password: [random]
```

### Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†

```bash
ssh k8s-master "bash /root/list-webtops.sh"
```

### Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±

```bash
ssh k8s-master "bash /root/delete-webtop.sh USERNAME"
```

---

## ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª

### kubectl

```bash
# Pods
kubectl get pods -n webtops

# Logs
kubectl logs -n webtops webtop-USERNAME-xxxxx

# Shell
kubectl exec -it -n webtops webtop-USERNAME-xxxxx -- bash

# Restart
kubectl rollout restart deployment -n webtops webtop-USERNAME
```

### ØªØºÛŒÛŒØ± Ø±Ù…Ø²

```bash
kubectl delete secret -n webtops webtop-USERNAME-secret
kubectl create secret generic webtop-USERNAME-secret \
  -n webtops --from-literal=password='NEW_PASS'
kubectl rollout restart deployment -n webtops webtop-USERNAME
```

---

## ğŸ“Š Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯

```bash
# Nodes
kubectl get nodes
kubectl top nodes

# Pods  
kubectl top pods -n webtops

# Events
kubectl get events -n webtops --sort-by='.lastTimestamp'
```

---

## ğŸ’¾ Backup

### Ú©Ø§Ø±Ø¨Ø±

```bash
# Backup
kubectl exec -n webtops POD -- tar czf /tmp/backup.tar.gz /config
kubectl cp webtops/POD:/tmp/backup.tar.gz ./backup.tar.gz

# Restore
kubectl cp ./backup.tar.gz webtops/POD:/tmp/
kubectl exec -n webtops POD -- tar xzf /tmp/backup.tar.gz -C /
```

### Ú©Ù„Ø§Ø³ØªØ±

```bash
# etcd snapshot
ssh k8s-master "k3s etcd-snapshot save"

# Resources
kubectl get all -A -o yaml > backup.yaml
```

---

## ğŸ› Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ

### Pod Pending

```bash
kubectl describe pod -n webtops POD
kubectl top nodes  # Check resources
```

### URL Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯

```bash
# DNS
nslookup USERNAME.haiocloud.com

# Ingress
kubectl get ingress -n webtops
kubectl describe ingress -n webtops webtop-USERNAME-ingress

# Traefik
kubectl logs -n kube-system -l app.kubernetes.io/name=traefik
```

### Performance

```bash
# Resources
kubectl top pod -n webtops POD

# Increase
kubectl patch deployment -n webtops webtop-USERNAME --type='json' -p='[
  {"op": "replace", "path": "/spec/template/spec/containers/0/resources/limits/cpu", "value": "2000m"},
  {"op": "replace", "path": "/spec/template/spec/containers/0/resources/limits/memory", "value": "4Gi"}
]'
```

---

## ğŸ“ˆ Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ

### Worker Ø¬Ø¯ÛŒØ¯

```bash
# Ø±ÙˆÛŒ Ø³Ø±ÙˆØ± Ø¬Ø¯ÛŒØ¯
K3S_TOKEN="[TOKEN]"
K3S_URL="https://94.182.92.207:6443"
curl -sfL https://get.k3s.io | sh -s - agent --server $K3S_URL --token $K3S_TOKEN
```

---

## ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª

### Ø³Ø§Ø®ØªØ§Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§

```
haiocloud-k8s/
â”œâ”€â”€ 01-install-k3s-master.sh
â”œâ”€â”€ 02-install-k3s-worker.sh  
â”œâ”€â”€ 03-install-metallb.sh
â”œâ”€â”€ 04-install-traefik.sh
â”œâ”€â”€ metallb-config.yaml
â”œâ”€â”€ webtop-template.yaml
â”œâ”€â”€ create-webtop.sh
â”œâ”€â”€ delete-webtop.sh
â”œâ”€â”€ list-webtops.sh
â””â”€â”€ README.md
```

### SSH Config

```ssh
Host k8s-master
    HostName 94.182.92.207
    User root
    Port 2280
```

---

## â“ FAQ

**Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø±ØŸ**  
20-80 Ú©Ø§Ø±Ø¨Ø± Ø¨Ø³ØªÙ‡ Ø¨Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡

**SSLØŸ**  
ÙØ¹Ù„Ø§Ù‹ HTTPØŒ SSL Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ

**Ø±Ù…Ø² Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒØŸ**  
```bash
kubectl get secret -n webtops webtop-USER-secret -o jsonpath='{.data.password}' | base64 -d
```

**Backup Ø®ÙˆØ¯Ú©Ø§Ø±ØŸ**  
Ø§Ø² CronJob Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

---

## ğŸ“ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

- **GitHub**: https://github.com/Mehrdad-Hooshmand/haiocloud-k8s
- **Email**: mehrdad@haiocloud.com
- **Telegram**: @Mehrdad_Hooshmand

---

## ğŸ“œ Ù„Ø§ÛŒØ³Ù†Ø³

MIT License

---

## ğŸ™ Ù…Ù†Ø§Ø¨Ø¹

- [K3s](https://k3s.io/)
- [LinuxServer.io](https://www.linuxserver.io/)
- [Traefik](https://traefik.io/)
- [MetalLB](https://metallb.universe.tf/)

---

**Version:** 1.0.0  
**Updated:** 2025-10-29  
**Author:** Mehrdad Hooshmand
